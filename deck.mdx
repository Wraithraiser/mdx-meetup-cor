import { Head } from 'mdx-deck'
import {Appear, Notes} from 'mdx-deck'
import { CodeSurfer } from "mdx-deck-code-surfer"
import { Split } from 'mdx-deck/layouts'
// import oceanicNext from "prism-react-renderer/themes/oceanicNext"
import nightOwl from "prism-react-renderer/themes/nightOwl"
import './script.js'
import WhiteLayout from './components/white-layout'
import Layout from './components/layout.js';
import { FirstSlide } from './components/first-slide'

export { default as theme } from './theme'

<Head>
  <title>mdx-deck</title>
</Head>

export default WhiteLayout

<FirstSlide
  title="Express & Middleware"
  subtitle="L'incarnation de la Cha√Æne de Responsabilit√©"
/>

<img width="500px" height="250px" src="public/abbeal.png" />

```notes
- Prez
- Audience 3 questions
- Partager mon aventure avec Express.js
```

---

# En route

<img width="154px" height="54px" src="public/dash-race-car.png" />

---

# Express.js 

<img width="500px" height="300px" src="public/node-logo.svg.png" />

```notes
- Express.js => Node.js web application framework 
- Etendre, Augmenter Node.js => Layer on top Node.js HTTP server 
- Routing + Middleware Pattern 
```

---

# Bien avant le "Middleware Pattern"

```notes
- Pattern ?
- Design Pattern ?
- M√™me chose ? R√©ponse oui & non 
```

---

# Design Patterns
## Gang of Four ( GoF ) 
üìñ
<h3>Erich Gamma, Richard Helm, Ralph Johnson, John Vlissides</h3>

```notes
- Bouquin => 23 DP
- Middleware ne fait pas partie => Distinction ( avant et apr√®s) +
- Racine dans le monde Objet
- Comment transvaser ?
- Mais on les retrouve dans JS => Why ? Revenir √† la d√©f d'un DP
```

---

## Solution face √† un probl√®me r√©current dans un contexte particulier

<h3>Recette de cuisine üìú</h3>

---

## Design Pattern

<Appear>
  <h2>Nom</h2>
  <h2>Probl√®me</h2>
  <h2>Solution</h2>
  <h2>Cons√©quences</h2>
</Appear>

```notes
- Qu'importe le langage => Coeur du probl√®me identique
- Solution impl diff
```
---

## Plus loin que la documentation officielle ü§î

<h3> Design Pattern du GoF : <div>Chain of Responsibility</div></h3>

---


<img width="400" height="400px" src="public/colis.png" />

<!-- ## L'exp√©diteur d'une requ√™te n'a pas √† connaitre ses destinataires -->
## Un exp√©diteur n'a pas besoin de conna√Ætre ses destinataires

---

<img width="800px" height="800px" src="public/CoR.png" />

```notes
- Transmettre la requ√™te √† un ensemble de services susceptibles de la traiter.
- L'ensemble des services forment une cha√Æne et la requ√™te est transmise de service en service jusqu'√† son traitement.
- Flexible, d√©couplage, responsabilit√©, ind√©pendant
- Ordre important (priorit√©), requ√™te non trait√©e, performance 
```

---

## Et dans le monde Node.js ?

---

## Middleware dans Express

```notes
- Ensemble de services souvent sous la forme de fonctions
- Organis√©es en pipeline (chainage)
- Responsable traitement des requ√™tes HTTP et des r√©ponses renvoy√©es
- D√©f === CoR
- Ceux qui connaissent => middleware pas que √ßa
- Mixte de DP
```
---

<CodeSurfer
  code={require("raw-loader!./snippets/1.snippet")}
  title="Middleware signature"
  lang="javascript"
  theme={nightOwl}
/>


---
export default Layout

<CodeSurfer
  code={require("raw-loader!./snippets/2.snippet")}
  title="D√©marrer Express"
  lang="javascript"
  theme={nightOwl}
  showNumbers={false}
/>

---

<CodeSurfer
  code={require("raw-loader!./snippets/3.snippet")}
  title="Des Middlewares"
  lang="javascript"
  theme={nightOwl}
  showNumbers
  steps= {[
    { range: [1, 6]},
    { lines: [1] },
    { tokens: { 1: [4, 6, 8] }},
    { lines: [2] },
    { lines: [3] },
    { range: [4, 5]},
    { range: [8, 12]},
    { range: [14, 16]},
  ]}
/>

---

<CodeSurfer
  code={require("raw-loader!./snippets/4.snippet")}
  title="Mise en place du pipeline"
  lang="javascript"
  theme={nightOwl}
  showNumbers
  steps= {[
    { lines: [1]},
    { tokens: { 1: [4] }},
    { tokens: { 1: [6] }},
    { lines: [3]},
    { tokens: { 3: [2] }},
    { tokens: { 3: [4, 6] }},
    { range: [5, 7]},
  ]}
/>

---

export default Layout

<CodeSurfer
  code={require("raw-loader!./snippets/5.snippet")}
  title="On raccroche le tout"
  lang="javascript"
  theme={nightOwl}
  showNumbers
  steps= {[
    { range: [6, 11]},
    { range: [13, 17]},
    { range: [19, 21]},
    { lines: [23]},
    { lines: [25]},
    { range: [27, 29]},
    { range: [1, 31]},
  ]}
/>

---

http://localhost:3000/

<!--
<div>Middleware 1</div>
<div>Middleware 2</div>
<div>Middleware 3</div>
<div>Middleware 2 AGAIN</div>
<div>Middleware 1 AGAIN</div>
-->

---

http://localhost:3000/hello

<!--
<div>Middleware 1</div>
<div>Middleware 2</div>
<div>Hello World</div>
<div>Middleware 2 AGAIN</div>
<div>Middleware 1 AGAIN</div>
-->

<!-- ---

# Middleware comme Pattern -->

---

## Derri√®re chaque nouveaut√© se cache des fondamentaux

<!-- ---

# Retenir en quelques points
 üí°  -->

---

## Merci de votre √©coute ! 
## Des questions ? üòÅ